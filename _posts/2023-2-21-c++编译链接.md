---
layout: post
tags: [c++]
title: "c++ 预处理编译链接"
date: 2023-2-21
author: wsxk
comments: true
---

- [预处理](#预处理)
- [编译](#编译)
- [链接](#链接)
  - [神秘错误](#神秘错误)


## 预处理<br>
预处理有3个经常用的东西`#include`,`#define`,`#if #endif`<br>
其实预处理的意思大概就是，原文替换<br>
有一个a.h文件
```c
void test(){
    return ;
}
```
有一个a.c文件
```c
#include "a.h"
void test2(){
    test();
}
```
经过预处理后，实际的a.c文件是这样的
```c
void test(){
    return ;
}
void test2(){
    test();
}
```

## 编译<br>
编译其实就是把源代码`.cpp`转换成二进制代码`.obj`<br>
关注点是，应该明白`声明(declaration)`和`定义(definition)`的区别。<br>
> 1. 声明指的是告诉编译器，这个东西是存在的
> 2. 定义就是，这个东西到底是什么
>

## 链接<br>
把一个项目的所有的`.obj`链接成一个可执行程序`.exe`<br>
`static` 在函数前，表示这个函数只会在这个文件被使用（免除链接阶段）<br>
`inline` 在函数去，这个函数被其他函数调用时效果和`#include`一样<br>

### 神秘错误<br>
有个文件`Log.h`
```c++
#pragma once
#include <iostream>
void Log(const char* message) {
	std::cout << message << std::endl;
}
```
另一个文件`Log.cpp`
```c++
#include "Log.h"

void init_log() {
	Log("init_log");
}
```
还有一个文件`math.cpp`
```c++
#include <iostream>
#include "Log.h"
static int multiply(int a, int b) {
	int result = a * b;
	Log("multiply");
	return result;
}
int main() {
	std::cout << multiply(5, 8) << std::endl;

}
```

在链接阶段会报错，因为`#include`的特性，实际上`Log`函数被定义了2次。<br>

**解决办法**<br>
> 1.使用 static 关键字
> 2.使用 inline 关键字
> 3. 头文件不要定义！！！ 
