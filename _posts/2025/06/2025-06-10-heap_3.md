---
layout: post
tags: [pwn]
title: "glibc 2.35 malloc/free全流程"
author: wsxk
date: 2025-6-10
comments: true
---

- [0. 回顾： tcache](#0-回顾-tcache)
- [1. glibc： free](#1-glibc-free)

PS：之前的利用基本都集中在`tcache`中，但是libc的堆管理远不止`tcache`，现在我们来看看`libc`中堆管理到底会怎么分配内存<br>

# 0. 回顾： tcache<br>
到目前为止，我们学习过的tcache，有四个明显的特性:<br>
```
1. Bins of constant size up to 1032 bytes
2. Caches up to seven freed chunks
3. Singly linked list
4. Safe-Linking
```
tcache被free时，其元数据如下所示:<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2025-9-25/20250602110814.png)
其中**size的前3位，分别为A(标志chunk是否是main_arena以外的arena分配)，M(标志chunk是否是mmap出来的)，P(prev_inuse为，标志前一个chunk是否被使用，1都是已经被使用)**<br>
下图为一个tcachebin的结构:<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2025-9-25/20250602110958.png)

# 1. glibc： free<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2025-9-25/20250602110444.png)


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C22S5YSYL7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C22S5YSYL7');
</script>