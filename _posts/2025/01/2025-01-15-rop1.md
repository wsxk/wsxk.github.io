---
layout: post
tags: [pwn]
title: "ROP 利用手法"
author: wsxk
date: 2025-1-15
comments: true
---

- [0. checksec起手](#0-checksec起手)
- [1. ROP gadgets 搜索](#1-rop-gadgets-搜索)
  - [1.1](#11)

# 0. checksec起手<br>
一般情况下，安装`pwntools`后，就会默认帮你安装`checksec`，这个命令非常好用，主要的功能是帮助你了解程序开启了哪些保护。<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-9-25/20250112103808.png)
```
Arch: 
程序架构，这里告诉你是x86_64

RELRO(read only relocation): 
设置符号重定向表格为只读或在程序启动时就解析并绑定所有动态符号，从而减少对GOT（Global Offset Table）攻击。RELRO为” Partial RELRO”，说明我们对GOT表具有写权限。

Stack: 
有无canary

NX: 
no-execute，即栈不可执行

PIE(position independent executable): 
位置无关代码

SHSTK: 前提条件，开启CET（CONTROL-FLOW ENFORCEMENT TECHNOLOGY）
shadow stack，当shadow stack开启时，CALL指令会把返回地址同时压入数据栈和影子栈（shadow stack），RET指令会把返回地址同时从数据栈和影子栈取出，并比较。
如果从两个栈中取出的返回地址不匹配，那么就会触发控制保护异常（#CP）

IBT: 前提条件，开启CET（CONTROL-FLOW ENFORCEMENT TECHNOLOGY）
indirect branch tracker,应用于间接跳转（jmp/call指令），如果在间接跳转后的下一条指令不是ENDBR32或ENDBR64，就会触发#CP异常。
并不包括RIP相对跳转、远直接jmp跳转、call相对跳转等，这些都是跳转到固定地址，不存在被篡改的可能，因此IBT并不作用于这种情况

Stripped：是否去了符号 

```
总之，开始ctf之前，起手checksec是常规操作<br>

# 1. ROP gadgets 搜索<br>
工欲善其事，必先利其器<br>
ROP中的gadget，人工搜索不现实，这里列出几个常见的好用的rop gadget搜索工具<br>
## 1.1 