---
layout: post
tags: [web]
title: "web security: 安全的本质&浏览器安全"
date: 2024-1-10 
author: wsxk
comments: true
---

- [前言](#前言)
- [1. 安全的本质](#1-安全的本质)
  - [1.1 安全三要素](#11-安全三要素)
  - [1.2 安全评估](#12-安全评估)
    - [1.2.1 资产等级划分](#121-资产等级划分)
    - [1.2.2 威胁分析](#122-威胁分析)
    - [1.2.3 风险分析](#123-风险分析)
    - [1.2.4 确认解决方案](#124-确认解决方案)
  - [1.3 对解决方案有帮助的几个原则](#13-对解决方案有帮助的几个原则)
    - [1.3.1 Secure By Default原则](#131-secure-by-default原则)
    - [1.3.2 最小权限原则](#132-最小权限原则)
    - [1.3.3 纵深防御原则](#133-纵深防御原则)
    - [1.3.4 数据与代码分离原则](#134-数据与代码分离原则)
    - [1.3.5 不可预测性原则](#135-不可预测性原则)
- [2. 浏览器安全](#2-浏览器安全)
  - [2.1 同源策略](#21-同源策略)
  - [2.2 浏览器沙箱](#22-浏览器沙箱)
  - [2.3 恶意网址拦截](#23-恶意网址拦截)


## 前言<br>
记录一下学习web安全的旅程，不过话又说回来，主要是看《白帽子讲web安全》的书，做一下自己感觉有用的记录（🦑<br>

## 1. 安全的本质<br>
从安全的角度来看，我们将不同重要程度的区域划分出来：
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240110222229.png)
通过一个安全检查（过滤、净化）的过程，可以梳理未知的人或物，使其
变得可信任。被划分出来的具有不同信任级别的区域，我们称为信任域，
划分两个不同信任域之间的边界，我们称为信任边界。<br>
数据从高等级的信任域流向低等级的信任域，是不需要经过安全检查的；
数据从低等级的信任域流向高等级的信任域，则需要经过信任边界的安全
检查。<br>
***安全问题的本质是信任的问题***<br>
一切的安全方案设计的基础，都是建立在信任关系上的。我们必须相信一
些东西，必须有一些最基本的假设，安全方案才能得以建立；如果我们否
定一切，安全方案就会如无源之水，无根之木，无法设计，也无法完成

### 1.1 安全三要素<br>
`机密性(confidentiality)`：即要求数据不会被泄露<br>
`完整性(integrity)`: 即要求数据不会被篡改<br>
`可用性（avaliablity）`：即服务可用，不会被打挂<br>

### 1.2 安全评估<br>
分析安全问题，主要分为四个阶段<br>
**资产等级划分、威胁分析、风险分析、确认解决方案。**<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240110222854.png)
#### 1.2.1 资产等级划分<br>
资产等级划分，顾名思义了，以互联网公司为例，最重要的资产当然是用户数据，其次就是代码、员工信息，等等<br>
虽然这些资产都很重要，但是我们也需要分出三六九等<br>
当完成资产等级划分后，对要保护的目标已经有了一个大概的了解，接下来就是要划分信任域和信任边界了。通常我们用一种最简单的划分方式，就是从**网络逻辑**上来划分。比如最重要的数据放在数据库里，那么把数据库的服务器圈起来；Web应用可以从数据库中读/写数据，并对外提供服务，那再把Web服务器圈起来；最外面是不可信任的Internet。<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240110224319.png)
在这种情况，就需要再每个边界进行安全检查。<br>

#### 1.2.2 威胁分析<br>
可能造成危害的来源叫做`威胁`<br>
什么是威胁分析？威胁分析就是把所有的威胁都找出来。怎么找？一般是采用**头脑风暴法。**<br>
当然，也有一些比较科学的方法，比如使用一个模型，帮助我们去想，在哪些方面有可能会存在威胁，这个过程能够避免遗漏，这就是威胁建模。<br>
比如微软的`STRIDE`模型，它把威胁分为六类：<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240111001131.png)

#### 1.2.3 风险分析<br>
可能出现的损失叫做`风险`<br>
`DREAD`模型用于衡量风险大小<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240111213201.png)


#### 1.2.4 确认解决方案<br>
安全评估的产出物，就是安全解决方案。解决方案一定要有针对性，这种
针对性是由资产等级划分、威胁分析、风险分析等阶段的结果给出的<br>
一个优秀的安全方案应该具备以下特点：<br>
```
• 能够有效解决问题；
• 用户体验好；
• 高性能；
• 低耦合；
• 易于扩展与升级。
```

### 1.3 对解决方案有帮助的几个原则<br>
#### 1.3.1 Secure By Default原则<br>
本质上是多使用**白名单**而不是黑名单<br>
在选择使用白名单时，需要注意避免出现类似通配符的问题。<br>

#### 1.3.2 最小权限原则<br>
最小权限原则要求系统只授予主体必要的权限，而不要过度授权，这样能有效地减少系统、网络、应用、数据库出错的机会。<br>
说白了，就是没必要的权限不要给<br>

#### 1.3.3 纵深防御原则<br>
纵深防御包含两层含义：<br>
首先，要在各个不同层面、不同方面实施安全方案，避免出现疏漏，不同安全方案之间需要相互配合，构成一个整体；其次，要在正确的地方做正确的事情，即：在解决根本问题的地方实施针对性的安全方案。<br>

#### 1.3.4 数据与代码分离原则<br>
字面意思<br>
数据不能与代码放在一起<br>

#### 1.3.5 不可预测性原则<br>
不可预测性（Unpredictable），能有效地对抗基于篡改、伪造的攻击,像`ASLR`就是不可预测性的最直接展示<br>


## 2. 浏览器安全<br>
### 2.1 同源策略<br>
同源策略（Same Origin Policy）是一种约定，它是浏览器最核心也最基
本的安全功能<br>
浏览器的同源策略，限制了来自不同源的“document”或脚本，对当
前“document”读取或设置某些属性。<br>
这一策略极其重要，试想如果没有同源策略，可能a.com的一段JavaScript脚本，在b.com未曾加载此脚本时，也可以随意涂改b.com的页面（在浏览器的显示中）。<br>
同源其实指的是**相同的访问协议、相同的域名、相同的端口**<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2023-12-30/20240112024201.png)
需要注意的是，对于当前页面来说，页面内存放JavaScript文件的域并不
重要，重要的是加载JavaScript页面所在的域是什么<br>
换言之，a.com通过以下代码：
```javascript
<script src=http://b.com/b.js ></script>
```
加载了b.com上的b.js，但是b.js是运行在a.com页面中的，因此对于当前
打开的页面（a.com页面）来说，b.js的Origin就应该是a.com而非
b.com。<br>
在浏览器中，`<script>、<img>、<iframe>、<link>`等标签都可以
跨域加载资源，而不受同源策略的限制。<br>
这些带“src”属性的标签每次加载时，实际上是由浏览器发起了一次GET请求。不同于XMLHttpRequest的是， 通过src属性加载的资源，浏览器限制了JavaScript的权限，使其不能读写返回的内容。(**这句话指的是：当你在自己网页通过`<script src=http://b.com/b.js></script>`调用b.js时，不能读取，或者修改b.js的内容**)。<br>
对于XMLHttpRequest而言，可以访问来自同源对象的内容，它需要通过目标域返回的HTTP头来授权是否允许跨域访问，因为HTTP头对于JavaScript来说一般是无法控制的，所以认为这个方案可以实施<br>
对于浏览器来说，除了DOM（document object model，一种js的API，可用于操作和访问页面内容）、Cookie、XMLHttpRequest（一种js api，负责）会受到同源策略的限制外，浏览器加载的一些第三方插件也有各自的同源策略。最常见的一些插件如Flash、Java Applet、Sil-verlight、Google Gears等都有自己的控制策略<br>

### 2.2 浏览器沙箱<br>
这种在网页中插入一段恶意代码，利用浏览器漏洞执行任意代码的攻击方
式，在黑客圈子里被形象地称为“挂马”。<br>
在大量的黑客攻击下，浏览器结合系统（比如windows的DEP，aslr safeSEH等功能）的保护抵抗内存攻击，还发展出了多进程架构，从安全性上有了很大的提高。<br>
浏览器的多进程架构，将浏览器的各个功能模块分开，各个浏览器实例分
开，当一个进程崩溃时，也不会影响到其他的进程。<br>
Sandbox即沙箱，计算机技术发展到今天，Sandbox已经成为泛指“资源隔离类模块”的代名词。**Sandbox的设计目的一般是为了让不可信任的代码运行在一定的环境中，限制不可信任的代码访问隔离区之外的资源。**如果一定要跨越Sandbox边界产生数据交换，则只能通过指定的数据通道，比如经过封装的API来完成，在这些API中会严格检查请求的合法性。<br>

### 2.3 恶意网址拦截<br>
恶意网址拦截的工作原理很简单，**一般都是浏览器周期性地从服务器端获取一份最新的恶意网址黑名单，如果用户上网时访问的网址存在于此黑名单中，浏览器就会弹出一个警告页面**。<br>
常见的恶意网址分为两类：`一类是挂马网站`，这些网站通常包含有恶意的脚本如JavaScript或Flash，通过利用浏览器的漏洞（包括一些插件、控件漏洞）执行shellcode，在用户电脑中植入木马；`另一类是钓鱼网站`，通过模仿知名网站的相似页面来欺骗用户。<br>
要识别这两类恶意网址需要做建模，但这些模型放在客户端，一来攻击者也可以看到，就可以分析绕过；二来还会侵犯用户隐私；所以一般不这么干,就只能用`黑名单`的办法<br>
