---
layout: post
tags: [web]
title: "SQL & Same-Origin Policy"
date: 2024-7-22
author: wsxk
comments: true
---

- [1. SQL(structured query language)](#1-sqlstructured-query-language)
  - [1.1 CREATE TABLE](#11-create-table)
  - [1.2 DROP TABLE](#12-drop-table)
  - [1.3 INSERT INTO](#13-insert-into)
  - [1.4 SELECT](#14-select)
  - [1.5 DELETE](#15-delete)
  - [1.6 UPDATE](#16-update)
  - [1.7 UNION](#17-union)
  - [1.8 The Schema Table](#18-the-schema-table)
- [2. Same-Origin Policy](#2-same-origin-policy)
  - [2.1 OriginåŸºæœ¬æ¦‚å¿µ](#21-originåŸºæœ¬æ¦‚å¿µ)
  - [2.2 Sending HTTP Requests Cross-Origin](#22-sending-http-requests-cross-origin)
  - [2.3 Reading HTTP Responses Cross-Origin](#23-reading-http-responses-cross-origin)
  - [2.4 Domain Name(åŸŸå)](#24-domain-nameåŸŸå)
    - [2.4.1 Top-Level Domain (é¡¶çº§åŸŸå)](#241-top-level-domain-é¡¶çº§åŸŸå)
    - [2.4.2 Effective Top-Level Domain(æœ‰æ•ˆé¡¶çº§åŸŸå)](#242-effective-top-level-domainæœ‰æ•ˆé¡¶çº§åŸŸå)
  - [2.5 Site](#25-site)
  - [2.6 SameSite Cookie Attribute](#26-samesite-cookie-attribute)


## 1. SQL(structured query language)<br>
`sqlæ˜¯ä¸€ç§æŸ¥è¯¢æ•°æ®çš„è¯­è¨€`<br>
### 1.1 CREATE TABLE<br>
åˆ›å»ºè¡¨:<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191144.png)

### 1.2 DROP TABLE<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191551.png)

### 1.3 INSERT INTO<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191224.png)

### 1.4 SELECT<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191301.png)


### 1.5 DELETE<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191359.png)

### 1.6 UPDATE<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191429.png)

### 1.7 UNION<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191454.png)

### 1.8 The Schema Table<br>
`The Schema Table`æ˜¯å„ä¸ªæ•°æ®åº“é‡Œéƒ½æœ‰çš„ç”¨æ¥å­˜æ”¾`tableä¿¡æ¯`çš„`table`<br>
![](https://raw.githubusercontent.com/wsxk/wsxk_pictures/main/2024-3-25/20240722191655.png)

## 2. Same-Origin Policy<br>
åŒæºç­–ç•¥(same-origin policy)æ˜¯**æµè§ˆå™¨æœ€åŸºæœ¬ã€æœ€æ ¸å¿ƒçš„å®‰å…¨åŠŸèƒ½**ï¼Œæ‰€ä»¥åªé’ˆå¯¹æµè§ˆå™¨ï¼Œè¿™ä¸€ç‚¹è¦ç¡®è®¤å¥½ï¼ˆanywayï¼Œä½ ç”¨wgetç­‰å‘½ä»¤æ¥ä¸‹è½½ä¸œè¥¿çš„æ—¶å€™åªéœ€è¦éšä¾¿ç‚¹ç‚¹å°±è¡Œäº†,è€Œæµè§ˆå™¨è¦å…³æ³¨çš„äº‹æƒ…å°±å¾ˆå¤šäº†ğŸ˜€<br>
### 2.1 OriginåŸºæœ¬æ¦‚å¿µ<br>

```
ä¹¦æ¥ä¸Šå›ï¼Œä¸€ä¸ªhttp url schemeçš„ç»“æ„å¦‚ä¸‹:
<scheme>://<host>:<port>/<path>?<query>#<fragment>

ä¸€ä¸ªhttp urlæ¥è¯´ï¼Œå…¶originä¸º:
(<scheme>, <host>, <port>)
```
åˆ¤æ–­åŒæºçš„æ ‡å‡†å…¶å®æ˜¯**åè®®ã€åŸŸåã€ç«¯å£ä¸€è‡´**<br>
æ‰€ä»¥:
```
åŒæºï¼š
http://example.com/				(http, example.com, 80)
http://example.com/cat.gif		(http, example.com, 80) 

ä¸åŒæºï¼š
åè®®ä¸ä¸€è‡´ï¼š
http://example.com/				(http, example.com, 80)
https://example.com/				(https, example.com, 80)
åŸŸåä¸ä¸€è‡´ï¼š
http://example.com/				(http, example.com, 80)
http://cats.example.com/		(http, cats.example.com, 80)
ç«¯å£ä¸ä¸€è‡´ï¼š
http://example.com/				(http, example.com, 80)
http://example.com:8080/		(http, example.com, 8080)
```

### 2.2 Sending HTTP Requests Cross-Origin<br>
åŒæºç­–ç•¥ä¹‹ä¸€ï¼š`è·¨åŸŸhttpè¯·æ±‚`ï¼š<br>
`è·¨åŸŸhttpè¯·æ±‚`é€šå¸¸å‘ç”Ÿåœ¨åœ¨æµè§ˆå™¨çš„ç½‘é¡µé‡Œ`http://example.com:80`å‘é€è¯·æ±‚åˆ°å¦ä¸€ä¸ªåŸŸçš„æœåŠ¡å™¨(æ¯”å¦‚`https://api.example.com:443`)çš„èµ„æºæ—¶<br>
è¯¥è¯·æ±‚ç‰¹ç‚¹ï¼š<br>
```
1ã€ç”±å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰å‘èµ·
2ã€è¯·æ±‚å¯èƒ½åŒ…æ‹¬getã€postã€putã€deleteç­‰æ–¹æ³•
3ã€æ¶‰åŠè·¨åŸŸè®¿é—®
4ã€æœåŠ¡ç«¯ï¼ˆæœåŠ¡å™¨ï¼‰éœ€è¦é…ç½®CORSï¼ˆcross-origin resource sharingï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼‰ç­–ç•¥,æ¯ä¸€ä¸ªé¡µé¢éœ€è¦è¿”å›ä¸€ä¸ªåä¸ºAccess-Control-Allow-Originçš„httpå¤´æ¥å…è®¸å¤–åŸŸçš„ç«™ç‚¹è®¿é—®

å€¼å¾—ä¸€æçš„æ˜¯CORSéœ€è¦æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŒæ—¶æ”¯æŒ
```
**<br>
ç®€å•ç†è§£:**æœåŠ¡å™¨çš„å¤„ç†è¯·æ±‚çš„æ–¹æ³•å¦‚æœå…è®¸è·¨åŸŸè®¿é—®ï¼Œéƒ½éœ€è¦åœ¨è¿”å›å“åº”æ—¶è®¾ç½®Access-Control-Allow-Originæ¥å†³å®šå…è®¸å“ªäº›ç«™ç‚¹å¯ä»¥è®¿é—®è¯¥è¯·æ±‚**<br>

### 2.3 Reading HTTP Responses Cross-Origin<br>
`Reading HTTP Responses Cross-Origin`è¯·æ±‚ï¼Œåœ¨`2.2èŠ‚ä¸­ï¼ŒæœåŠ¡å™¨è¿”å›httpå“åº”å`ï¼Œ**æµè§ˆå™¨ä¼šæ ¹æ®æœåŠ¡å™¨è¿”å›httpå“åº”ä¸­çš„Access-Control-Allow-Originæ¥å†³å®šæ˜¯å¦è¯»å–è¯¥å“åº”å†…å®¹**<br>

### 2.4 Domain Name(åŸŸå)<br>
è™½ç„¶ç°åœ¨ä»‹ç»åŸŸåæœ‰ç‚¹è¿Ÿï¼Œä¸è¿‡è¿˜ä¸æ™š~<br>
ç›´ç™½çš„è¯´ï¼ŒåŸŸåå°±æ˜¯**ç”±ç‚¹å·åˆ†éš”çš„æ ‡ç­¾**<br>
å¦‚ä¸‹ä¾‹å­ä¸­éƒ½æ˜¯åŸŸå:<br>
```
www.example.com
www.google.com
www.google.co.uk
pwn.college
dojo.pwn.college
pwncollege.github.io
```

#### 2.4.1 Top-Level Domain (é¡¶çº§åŸŸå)<br>
ä¸€èˆ¬æ¥è¯´ï¼Œ**é¡¶çº§åŸŸåæ˜¯åŸŸåæœ€å³è¾¹æ ‡ç­¾**<br>
ä»¥ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œé¡¶çº§åŸŸåä¸º<br>
www.example.**com**<br>
www.google.**com**<br>
www.google.co.**uk**<br>
pwn.**college**<br>
dojo.pwn.**college**<br>
pwncollege.github.**io**<br>

#### 2.4.2 Effective Top-Level Domain(æœ‰æ•ˆé¡¶çº§åŸŸå)<br>
[https://publicsuffix.org/list/public_suffix_list.dat](https://publicsuffix.org/list/public_suffix_list.dat)ä¸­è®°å½•äº†æ‰€æœ‰æœ‰æ•ˆé¡¶çº§åŸŸå<br>
ä¹‹æ‰€ä»¥è¦æœ‰æœ‰æ•ˆé¡¶çº§åŸŸåï¼Œæ˜¯å› ä¸ºä¾‹å¦‚`github.io`ä¹Ÿè¢«ä½œä¸ºé¡¶çº§åŸŸåäº†ã€‚<br>
è¿˜æœ‰ä»¥ä¸Šé¢æåˆ°ä¸ºä¾‹ï¼Œæœ‰æ•ˆé¡¶çº§åŸŸåä¸ºï¼š<br>
www.example.**com**<br>
www.google.**com**<br>
www.google.**co.uk**<br>
pwn.**college**<br>
dojo.pwn.**college**<br>
pwncollege.**github.io**<br>


### 2.5 Site<br>
`site`å…¶å®æ˜¯`Effective Top-Level Domain +1 `<br>
ä¸¾ä¾‹å¦‚ä¸‹ï¼š<br>

www.**example.com**<br>
www.**google.com**<br>
www.**google.co.uk**<br>
**pwn.college**<br>
dojo.**pwn.college**<br>
**pwncollege.github.io**<br>


### 2.6 SameSite Cookie Attribute<br>
è‡³äºä¸ºä»€ä¹ˆè¦å®šä¹‰å‡º`site`è¿™ä¸ªæ¦‚å¿µï¼Œè¿™è·Ÿ`cookie`æ˜¯æ¯æ¯ç›¸å…³çš„ï¼Œæœ€æœ‰åçš„å°±æ˜¯`SameSite Cookieå±æ€§äº†`<br>
ä¼—æ‰€å‘¨çŸ¥å•Šï¼Œ`cookie`æ˜¯ç”¨æ¥ç»´æŒhttpçŠ¶æ€çš„ï¼ˆä¸çŸ¥é“çš„ç«¥é‹è¯·ç¿»é˜…[https://wsxk.github.io/web_basic/#18-cookie](https://wsxk.github.io/web_basic/#18-cookie)ï¼‰<br>
ç®€å•çš„è¯´ï¼ŒæœåŠ¡å™¨ä¼šç”¨cookieæ¥æ ‡è¯†å®¢æˆ·ç«¯ï¼Œä»¥æä¾›å®¢æˆ·ç«¯ä¸åŒçš„æœåŠ¡ã€‚**é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæœåŠ¡å™¨æä¾›çš„å„ç§æœåŠ¡éƒ½ç”±ä¸åŒçš„ç½‘å€æä¾›ï¼Œè¿™äº›ç½‘å€éƒ½ä¼šè¢«æ ‡è¯†ä¸ºåŒä¸€ä¸ªsiteï¼ˆè¡¨ç¤ºåŒä¸€ä¸ªæœåŠ¡å•†æä¾›çš„æœåŠ¡ï¼‰**<br>
æµè§ˆå™¨ä¼šæ ¹æ®æ˜¯å¦æ˜¯åŒä¸€ä¸ªsiteæ¥å†³å®šæ˜¯å¦åœ¨å‘é€è¯·æ±‚æ—¶å¸¦ä¸Š`cookie`ï¼Œ<br>
ç®€å•ä»‹ç»å®Œcookieåï¼Œç°åœ¨æ¥ä»‹ç»`samesite cookie attribute`å§ï¼Œ***samesite cookie attributeå†³å®šäº†æµè§ˆå™¨åœ¨å‘é€è·¨ç«™(cross site)è¯·æ±‚æ—¶æ˜¯å¦å‘é€æœ¬ç«™ç‚¹cookie***<br>
é…ç½®å¦‚ä¸‹:<br>
```
SameSite=None
Cookie is sent in cross-site requests
å…è®¸åœ¨å‘é€è·¨ç«™è¯·æ±‚æ—¶æºå¸¦æœ¬ç«™cookie
è¿™æ˜¯éå¸¸å±é™©çš„è¡Œä¸ºï¼Œæ¯”å¦‚ä½ åœ¨è®¿é—® aaa.example.comçš„ç½‘é¡µæ—¶ï¼Œaaa.example.com å‘ bbb.image.comï¼ˆè·¨ç«™ï¼‰è¯·æ±‚ä¸€å¼ å›¾ç‰‡æ—¶ï¼Œä¼šå‘é€bbb.image.comåœ¨ä½ æµè§ˆå™¨ä¸­çš„cookie


SameSite=Lax (default)
Cookie is sent in cross-site top-level navigation GET requests
é»˜è®¤è®¾ç½®ï¼Œåªæœ‰åœ¨å‘é€è·¨ç«™çš„Top-level navigation (é¡¶çº§å¯¼èˆª) çš„GETè¯·æ±‚æ—¶ï¼Œæ‰ä¼šå¸¦ä¸Šcookie
è¿™ä¸ªåœºæ™¯æ˜¯åœ¨ä½ è®¿é—®aaa.example.comçš„ç½‘é¡µåï¼Œä½ ç‚¹å‡»äº†ç½‘é¡µé‡Œçš„bbb.test.comçš„é“¾æ¥ï¼Œéšåè·³è½¬åˆ°bbb.test.comï¼ˆåŒæ—¶æµè§ˆå™¨çš„åœ°å€æ urlå‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œå¹¶ä¸”è¯·æ±‚æ˜¯GETè¯·æ±‚æ—¶ï¼Œæ‰ä¼šè®©å‘é€å…ˆå‰bbb.test.comçš„cookie

SameSite=Strict
Cookie is not sent in cross-site requests
Strictæœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œå½“å‰ç«™ç‚¹ä¸è¯·æ±‚ç›®æ ‡ç«™ç‚¹æ˜¯è·¨ç«™å…³ç³»æ—¶ï¼Œæ€»æ˜¯ä¸ä¼šå‘é€ Cookieã€‚æ¢è¨€ä¹‹ï¼Œåªæœ‰å½“å‰ç«™ç‚¹ ä¸è¯·æ±‚ç›®æ ‡ç«™ç‚¹æ˜¯åŒç«™å…³ç³»æ—¶ï¼Œæ‰ä¼šå¸¦ä¸Š Cookie
```
